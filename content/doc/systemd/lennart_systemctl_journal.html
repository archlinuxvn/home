---
title: "Log và trạng thái dịch vụ"
author: Lennart Poettering
origin: http://0pointer.de/blog/projects/systemctl-journal.html
date: 2012-may-18
tags: ['systemd', 'log', 'sysadmin', 'journald']
translators: tant
allow_comments: yes
license: CC BY-SA
---

Bài này ngắn thôi. Một trong những lệnh hay được dùng trong `systemd` là
lệnh systemctl status dùng để xác định trạng thái của một dịch vụ.
Lệnh này rất có ích để lấy thông tin về các tiến trình và những `meta data`
của dịch vụ chạy trên hệ thống

Ở Fedora 17, chúng tôi đã giới thiệu `journal`, một hệ thống `log` mới có
tính cấu trúc, được sắp chỉ mục và tin cậy của `systemd` mà vẫn tương
tích ở mức độ nào đó với `syslog` cổ điển. Lý do ban đầu thúc đẩy chúng
tôi bắt đầu làm journal khởi nguồn từ một ý tưởng nhìn có vẻ đơn giản
với người ngoài nhưng nếu không có journal thì rất khó và không hiệu
quả để có thể triển khai. Dữ liệu log là những thứ thông tin tối cần
thiết để có được trạng thái của dịch vụ, cho nên bổ sung thông tin này
sau trạng thái chung của dịch vụ rất có ích. Chúng tôi quyết định là
bên cạnh  output của systemctl status chúng tôi muốn hiện ra 10 câu
log của dịch vụ.

Nói ngắn gọn: vào lúc chúng tôi tích hợp `journal` vào `systemd` và
`Fedora`, chúng tôi cũng nó vào `systemclt`. Và đây là một mẫu `output`

    $ systemctl status avahi-daemon.service

    avahi-daemon.service - Avahi mDNS/DNS-SD Stack
     Loaded: loaded (/usr/lib/systemd/system/avahi-daemon.service; enabled)
     Active: active (running) since Fri, 18 May 2012 12:27:37 +0200; 14s ago
   Main PID: 8216 (avahi-daemon)
     Status: "avahi-daemon 0.6.30 starting up."
     CGroup: name=systemd:/system/avahi-daemon.service
     ├ 8216 avahi-daemon: running [omega.local]
     └ 8217 avahi-daemon: chroot helper

    May 18 12:27:37 omega avahi-daemon[8216]: Joining mDNS multicast group on interface eth1.IPv4 with address 172.31.0.52.
    May 18 12:27:37 omega avahi-daemon[8216]: New relevant interface eth1.IPv4 for mDNS.
    May 18 12:27:37 omega avahi-daemon[8216]: Network interface enumeration completed.
    May 18 12:27:37 omega avahi-daemon[8216]: Registering new address record for 192.168.122.1 on virbr0.IPv4.
    May 18 12:27:37 omega avahi-daemon[8216]: Registering new address record for fd00::e269:95ff:fe87:e282 on eth1.*.
    May 18 12:27:37 omega avahi-daemon[8216]: Registering new address record for 172.31.0.52 on eth1.IPv4.
    May 18 12:27:37 omega avahi-daemon[8216]: Registering HINFO record with values 'X86_64'/'LINUX'.
    May 18 12:27:38 omega avahi-daemon[8216]: Server startup complete. Host name is omega.local. Local service cookie is 3555095952.
    May 18 12:27:38 omega avahi-daemon[8216]: Service "omega" (/services/ssh.service) successfully established.
    May 18 12:27:38 omega avahi-daemon[8216]: Service "omega" (/services/sftp-ssh.service) successfully established.

Cái này hiện thông tin trạng thái của dịch vụ `mDNS/DNS-SD` mà mọi người
hay dùng. Trong đó là danh sách các tiến trình của nó và kèm theo _(như
đã hứa ^^)_ là 10 dòng log gần nhất. Xong chuyện.

Có một vài tùy chỉnh dòng lệnh cho `output` theo ý bạn. Hai tùy chỉnh
thú vị nhất là `-f` để kích hoạt chế độ chạy theo (`follow mode`) (tương
tự như `tail -f`) và `-n` để thay đổi số dòng muốn hiện (y như `tail -n`)

Dữ liệu `log` hiện ra được lấy từ 3 nguồn: Tất cả thứ mà các tiến trình
của dịch vụ log với hàm `syslog()` của `libc`, mọi thứ dược gửi lên bằng
`API journal` cùng với tất cả các thứ mà tiến trình của dịch vụ `log` vào
`STDOUT` hay `STDERR`. Tóm lại là tất cả gì mà tiến trình sinh ra dưới
dạng thông tin `log` là được thu thập, sắp xếp và xuất ra cùng một định
dạng

Hết rồi đó. Một tính năng đơn giản nhưng lại hết sức hữu dụng cho mọi
quản trị viên. Một món mà *Sao mình không có nó từ 15 năm trước vậy?*

Đừng đi đâu hết để chờ bản kế nha!
