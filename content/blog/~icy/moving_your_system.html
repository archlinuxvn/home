---
title: Chuyển hệ thống giữa các máy
allow_comment: yes
tags: ['upgrade']
---

# Chuyển hệ thống giữa các máy

Chú ý quan trọng:
<pre>
  Đây chỉ là bản thảo, đang viết dở dang.
  Làm theo hướng dẫn của bài này có thể phá hỏng hệ thống của bạn.
</pre>

Cài một bộ ArchLinux cho bất kỳ máy tính nào cũng là vấn đề dễ chịu. Bởi vì
có vấn đề chẳng đơn giản tí nào là chuyển hệ thống đang chạy từ máy này
qua máy khác.

Đây là một bài toán thực tế: Khi đi làm cho công ty A, bạn được cung cấp
máy tính xách tay (`laptop`); thay vì phải cài mới, cấu hình mọi thứ từ đầu
cho laptop, bạn chỉ việc bê nguyên các thứ từ PC ở nhà qua laptop.
Vào ngày đẹp trời khi bạn phải trả máy tính cho công ty, bạn lại bê nguyên
bộ cài Arch đang dùng qua PC, `format` ổ cứng của laptop trước khi trả nó
cho công ty với màn hình đen thui...

Và một ngày đẹp trời khác khi bạn vào công ty B, bạn lại có laptop mới,...

## Bước chuẩn bị

Giả sử có hai máy X, Y, và bạn cần chuyển hệ thống Arch từ máy X qua Y.
Bạn cần điều chỉnh để X, Y cùng nằm trong mạng LAN, sử dụng dây cáp để nối mạng
(kết nối không dây quá chậm do khối lượng dữ liệu lớn).

Bạn chuẩn bị USB với bộ cài đặt của ArchLinux (phiên bản cũ càng tốt,
vì cũ thường dễ xài): tìm lên trang chủ của ArchLinux tải về tập tin `.iso`,
hoặc lấy từ các bản đã có trên máy của bạn, rồi dùng lệnh `dd` để chuyển
dữ liệu ra USB như sau

<pre>
dd if=/path/to/iso/file of=/dev/my-usb
</pre>

với `my-usb` có thể là `sdb`, `sdc`,... tùy trường hợp. Bạn phải chọn đúng
vì lệnh `dd` dù thành công hay dang dở cũng khiến cho bạn mất sạch dữ liệu
cũ trên đích của nó. Nếu gặp may gõ nhầm thành `of=/dev/sda` thì xin chúc
mừng, bạn sẽ cón một màn than vãn không thể kịch hơn.

Bật máy X, có thể vào chế độ đồ họa

* Nhưng tắt tất cả các tiến trình có thể phát sinh các tập tin có thông
  tin đáng quý (trình duyệt thư, trình chát, chương trình chạy qua `crontab`,
  các chương trình sao lưu dữ liệu, ...);
  bạn cố thể không làm vậy, nhưng ở bước cuối cùng khi việc chuyển đổi gần
  hoàn tất, bạn phải làm vậy để đảm bảo không có dữ liệu nào bị mất;

* Bật `sshd` bằng lệnh `/etc/rc.d/sshd start` sau khi điều chỉnh tập tin
  `/etc/ssh/sshd_config` để dịch vụ `SSH` chấp nhận kiểu đăng nhập bằng
  chìa khóa (thiết lập `PasswordAuthentication`) và cho phép tài khoản
  `root` kết nối từ xa (`AllowUsers root`). Việc này chỉ làm tạm thời trong
  quá trình chuyển đổi, và khá an toàn khi bạn làm ở nhà. Sau khi hoàn
  tất chuyển đổi, bạn nhớ chỉnh lại thiết lập của dịch vụ `SSH`.

* Việc này quan trọng: Vào trang [arm] [], chọn ngày tháng cho phù hợp
  với bộ cài có trong USB, và tải về gói `rsync` nằm trong `extra`. Sau này
  bạn sẽ hiểu `rsync` để làm gì.

Với máy Y, khởi động từ USB

* Bạn tiến hành cài đặt thông thường, nhưng chỉ vài bước đầu. Ví dụ, chọn
  `mirror`, chọn giờ cài đặt (nhớ chọn cho đúng, chả mất gì nhưng đỡ rắc rối),
  ... cho tới bước phân vùng ổ cứng. Đây là bước quan trọng nhất. Bạn cần
  xác định đúng các phân vùng dành cho `/`, `/home/`, ...

[arm]: http://arm.konnichi.com/
